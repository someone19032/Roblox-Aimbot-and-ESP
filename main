local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LP = Players.LocalPlayer

local toggles = {
	BodyESP = false,
	BonesESP = false,
	NameESP = false,
	Aimbot = false,
	FOVToggle = true,
	UseDistance = true
}
local values = {
	FOVRadius = 200,
	MaxDistance = 1000
}
local highlights, nameTags, boneLines = {}, {}, {}

-- UI Setup
local gui = Instance.new("ScreenGui", LP:WaitForChild("PlayerGui"))
gui.Name = "AimESP_UI"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 250, 0, 330)
frame.Position = UDim2.new(0.5, -125, 0.5, -165)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0

local frameCorner = Instance.new("UICorner", frame)
frameCorner.CornerRadius = UDim.new(0, 8)

-- Header Bar
local header = Instance.new("Frame", frame)
header.Size = UDim2.new(1, 0, 0, 30)
header.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
header.BorderSizePixel = 0

local headerCorner = Instance.new("UICorner", header)
headerCorner.CornerRadius = UDim.new(0, 8)

local title = Instance.new("TextLabel", header)
title.Size = UDim2.new(1, -60, 1, 0)
title.Position = UDim2.new(0, 5, 0, 0)
title.BackgroundTransparency = 1
title.Text = "ESP & AIMBOT"
title.Font = Enum.Font.SourceSansBold
title.TextColor3 = Color3.new(1, 1, 1)
title.TextSize = 16
title.TextXAlignment = Enum.TextXAlignment.Left

local minimize = Instance.new("TextButton", header)
minimize.Size = UDim2.new(0, 20, 0, 20)
minimize.Position = UDim2.new(1, -50, 0.5, -10)
minimize.Text = "-"
minimize.Font = Enum.Font.SourceSansBold
minimize.TextColor3 = Color3.new(1, 1, 1)
minimize.TextSize = 16
minimize.BackgroundColor3 = Color3.fromRGB(70, 70, 70)

local minCorner = Instance.new("UICorner", minimize)
minCorner.CornerRadius = UDim.new(0, 4)

local close = Instance.new("TextButton", header)
close.Size = UDim2.new(0, 20, 0, 20)
close.Position = UDim2.new(1, -25, 0.5, -10)
close.Text = "X"
close.Font = Enum.Font.SourceSansBold
close.TextColor3 = Color3.new(1, 1, 1)
close.TextSize = 16
close.BackgroundColor3 = Color3.fromRGB(120, 40, 40)

local closeCorner = Instance.new("UICorner", close)
closeCorner.CornerRadius = UDim.new(0, 4)

-- Content container
local content = Instance.new("Frame", frame)
content.Size = UDim2.new(1, 0, 1, -30)
content.Position = UDim2.new(0, 0, 0, 30)
content.BackgroundTransparency = 1

local function createTitle(text, y)
	local label = Instance.new("TextLabel", content)
	label.Size = UDim2.new(1, -20, 0, 20)
	label.Position = UDim2.new(0, 10, 0, y)
	label.BackgroundTransparency = 1
	label.TextColor3 = Color3.new(1, 1, 1)
	label.Font = Enum.Font.SourceSansBold
	label.TextSize = 18
	label.Text = text
	label.TextXAlignment = Enum.TextXAlignment.Center
end

local function createToggle(text, y, key)
	local btn = Instance.new("TextButton", content)
	btn.Size = UDim2.new(0, 120, 0, 24)
	btn.Position = UDim2.new(0.5, -60, 0, y)
	btn.Text = text .. ": OFF"
	btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.SourceSans
	btn.TextSize = 14

	local corner = Instance.new("UICorner", btn)
	corner.CornerRadius = UDim.new(0, 6)

	btn.MouseButton1Click:Connect(function()
		toggles[key] = not toggles[key]
		btn.Text = text .. ": " .. (toggles[key] and "ON" or "OFF")
	end)
end

local function createInput(text, y, key)
	local label = Instance.new("TextLabel", content)
	label.Size = UDim2.new(0, 120, 0, 20)
	label.Position = UDim2.new(0.5, -85, 0, y)
	label.BackgroundTransparency = 1
	label.Text = text
	label.TextColor3 = Color3.new(1, 1, 1)
	label.Font = Enum.Font.SourceSans
	label.TextSize = 14
	label.TextXAlignment = Enum.TextXAlignment.Left

	local box = Instance.new("TextBox", content)
	box.Size = UDim2.new(0, 50, 0, 20)
	box.Position = UDim2.new(0.5, 45, 0, y)
	box.Text = tostring(values[key])
	box.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	box.TextColor3 = Color3.new(1, 1, 1)
	box.Font = Enum.Font.SourceSans
	box.TextSize = 14

	local boxCorner = Instance.new("UICorner", box)
	boxCorner.CornerRadius = UDim.new(0, 6)

	box.FocusLost:Connect(function()
		local val = tonumber(box.Text)
		if val then values[key] = val end
	end)
end

-- Layout
local y = 10
createTitle("--- ESP ---", y); y += 30
createToggle("Body ESP", y, "BodyESP"); y += 30
createToggle("Bones ESP", y, "BonesESP"); y += 30
createToggle("Name ESP", y, "NameESP"); y += 40
createTitle("--- Aimbot ---", y); y += 30
createToggle("Aimbot", y, "Aimbot"); y += 30
createToggle("FOV Toggle", y, "FOVToggle"); y += 30
createInput("FOV Radius", y, "FOVRadius"); y += 30
createToggle("Distance Toggle", y, "UseDistance"); y += 30
createInput("Max Distance", y, "MaxDistance")

-- Minimize behavior: collapse to a single small button
local minimized = false
minimize.MouseButton1Click:Connect(function()
	minimized = not minimized
	if minimized then
		-- shrink to a small button
		frame.Size = UDim2.new(0, 150, 0, 50)
		frame.Position = UDim2.new(0.5, -75, 0.5, -25)
		content.Visible = false
		header.Size = UDim2.new(1, 0, 1, 0)
		minimize.Text = "+"
	else
		-- restore full UI
		frame.Size = UDim2.new(0, 250, 0, 330)
		frame.Position = UDim2.new(0.5, -125, 0.5, -165)
		content.Visible = true
		header.Size = UDim2.new(1, 0, 0, 30)
		minimize.Text = "-"
	end
end)

close.MouseButton1Click:Connect(function()
	gui:Destroy()
end)

-- Draggable header
local dragging, dragInput, dragStart, startPos = false
header.InputBegan:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = i.Position
		startPos = frame.Position
		i.Changed:Connect(function()
			if i.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)
header.InputChanged:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = i
	end
end)
UIS.InputChanged:Connect(function(i)
	if i == dragInput and dragging then
		local delta = i.Position - dragStart
		frame.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end
end)

-- FOV Circle
local fovCircle = Drawing.new("Circle")
fovCircle.Color = Color3.new(1,1,1)
fovCircle.Thickness = 1
fovCircle.NumSides = 90
fovCircle.Filled = false
RunService.RenderStepped:Connect(function()
	local m = UIS:GetMouseLocation()
	fovCircle.Position = Vector2.new(m.X, m.Y - 36)
	fovCircle.Radius = values.FOVRadius
	fovCircle.Visible = toggles.Aimbot and toggles.FOVToggle
end)
